# simple-workspace .envrc
# Automatically sets up Python venv with colcon-nano-ros and sources ROS 2
# Uses uv for fast Python package management

# Source ROS 2
if [ -f /opt/ros/humble/setup.bash ]; then
    source /opt/ros/humble/setup.bash
elif [ -f /opt/ros/jazzy/setup.bash ]; then
    source /opt/ros/jazzy/setup.bash
else
    echo "Warning: ROS 2 not found"
fi

# Create and activate Python venv with access to system packages
VENV_DIR=".venv"
if [ ! -d "$VENV_DIR" ]; then
    echo "Creating Python venv with system-site-packages..."
    uv venv --system-site-packages "$VENV_DIR"
fi

source "$VENV_DIR/bin/activate"

# Check if colcon-nano-ros is installed, install if not
if ! python -c "import colcon_nano_ros" 2>/dev/null; then
    echo "Installing colcon-nano-ros..."
    uv pip install maturin
    pushd ../../colcon-nano-ros/packages/colcon-cargo-ros2 > /dev/null
    maturin develop --release
    popd > /dev/null
fi

# Source the workspace install if it exists
if [ -f install/setup.bash ]; then
    source install/setup.bash
fi
